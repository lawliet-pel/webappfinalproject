<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Final Project Demo - 浮動視窗</title>
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: "Noto Sans TC", Arial, sans-serif;
        background-color: #f7f4eb;
        color: #2f362f;
      }

      .app {
        display: flex;
        min-height: 100vh;
      }

      .sidebar {
        position: fixed;
        top: 20px;
        left: 45px;
        width: 280px;
        padding: 24px;
        border-radius: 24px;
        background: rgba(255, 255, 255, 0.92);
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.12);
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .sidebar h1 {
        margin: 0;
        font-size: 24px;
        letter-spacing: 2px;
        text-align: center;
      }

      .feature-list {
        display: grid;
        gap: 12px;
        max-height: 400px;
        overflow-y: auto;
        padding-right: 4px;
      }

      .feature-list::-webkit-scrollbar {
        width: 6px;
      }

      .feature-list::-webkit-scrollbar-track {
        background: transparent;
      }

      .feature-list::-webkit-scrollbar-thumb {
        background: #c2c2c2;
        border-radius: 3px;
      }

      .feature-list::-webkit-scrollbar-thumb:hover {
        background: #a0a0a0;
      }

      .feature-card {
        padding: 16px;
        border-radius: 16px;
        background: #d7f2ec;
        color: #1c5a4b;
        font-weight: bold;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        cursor: pointer;
        border: 2px solid transparent;
      }

      .feature-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
      }

      .feature-card.active {
        background: #8bd2c5;
        border-color: #2b8371;
        color: #103d33;
      }

      .chat-box {
        margin-top: 12px;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .chat-box label {
        font-weight: bold;
      }

      .chat-box textarea {
        width: 100%;
        min-height: 80px;
        resize: vertical;
        padding: 10px;
        border-radius: 12px;
        border: 1px solid #c2c2c2;
        font-family: inherit;
        font-size: 14px;
      }

      .chat-box button {
        align-self: flex-end;
        padding: 10px 18px;
        border-radius: 999px;
        border: none;
        background: linear-gradient(135deg, #ff9364, #f9698d);
        color: #fff;
        font-weight: bold;
        cursor: pointer;
        transition: opacity 0.2s ease;
      }

      .chat-box button:hover {
        opacity: 0.85;
      }

      .content {
        margin-left: 340px;
        margin-right: 80px;
        padding: 20px 40px 40px 40px;
        flex: 1;
        min-height: 100vh;
      }

      .content-card {
        width: 100%;
        min-height: calc(100vh - 80px);
        padding: 28px;
        border-radius: 24px;
        background: #ffffff;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.08);
      }

      .content-card h2 {
        margin-top: 0;
        font-size: 28px;
      }

      .message-preview {
        margin-top: 20px;
        padding: 16px;
        border-radius: 16px;
        background: #fff7e0;
        border: 1px dashed #e7b86d;
      }

       .ai-chat {
         margin-top: 28px;
         display: flex;
         flex-direction: column;
         gap: 16px;
       }

       .ai-messages {
         max-height: calc(100vh - 400px);
         min-height: 400px;
         overflow-y: auto;
         padding: 20px;
         border-radius: 18px;
         background: #faf7f2;
         box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.04);
         display: flex;
         flex-direction: column;
         gap: 14px;
       }

       .ai-bubble {
         max-width: 75%;
         padding: 14px 16px;
         border-radius: 18px;
         line-height: 1.6;
         white-space: pre-wrap;
         word-break: break-word;
         box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08);
       }

       .ai-bubble.user {
         align-self: flex-end;
         background: linear-gradient(135deg, #71d2c0, #48b7ab);
         color: #08352e;
       }

       .ai-bubble.bot {
         align-self: flex-start;
         background: #ffffff;
         color: #2f362f;
       }

       .ai-input {
         display: flex;
         gap: 12px;
         align-items: center;
         padding: 14px;
         border-radius: 16px;
         background: #fff;
         box-shadow: 0 12px 30px rgba(0, 0, 0, 0.08);
       }

       .ai-input textarea {
         flex: 1;
         border: none;
         resize: none;
         min-height: 60px;
         font-family: inherit;
         font-size: 15px;
         line-height: 1.6;
         background: transparent;
       }

       .ai-input textarea:focus {
         outline: none;
       }

       .ai-input button {
         padding: 12px 20px;
         border-radius: 12px;
         border: none;
         background: linear-gradient(135deg, #ff8b7d, #f965a7);
         color: #fff;
         font-weight: bold;
         cursor: pointer;
         transition: transform 0.2s ease, opacity 0.2s ease;
       }

       .ai-input button:hover {
         opacity: 0.9;
         transform: translateY(-1px);
       }

      /* 漢堡選單樣式 */
      .hamburger-menu {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
      }

      .hamburger-button {
        width: 50px;
        height: 50px;
        border-radius: 12px;
        background: rgba(255, 255, 255, 0.92);
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.12);
        border: none;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        gap: 5px;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      .hamburger-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 16px 35px rgba(0, 0, 0, 0.15);
      }

      .hamburger-button span {
        width: 24px;
        height: 3px;
        background: #2f362f;
        border-radius: 2px;
        transition: all 0.3s ease;
      }

      .hamburger-button.active span:nth-child(1) {
        transform: rotate(45deg) translate(7px, 7px);
      }

      .hamburger-button.active span:nth-child(2) {
        opacity: 0;
      }

      .hamburger-button.active span:nth-child(3) {
        transform: rotate(-45deg) translate(7px, -7px);
      }

      .menu-dropdown {
        position: absolute;
        top: 60px;
        right: 0;
        min-width: 200px;
        padding: 12px 0;
        border-radius: 16px;
        background: rgba(255, 255, 255, 0.98);
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
        opacity: 0;
        visibility: hidden;
        transform: translateY(-10px);
        transition: all 0.3s ease;
      }

      .menu-dropdown.active {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      .menu-item {
        padding: 14px 20px;
        color: #2f362f;
        cursor: pointer;
        transition: background-color 0.2s ease;
        font-weight: 500;
      }

      .menu-item:hover {
        background-color: #f0f0f0;
      }

      .menu-item:first-child {
        border-top-left-radius: 16px;
        border-top-right-radius: 16px;
      }

      .menu-item:last-child {
        border-bottom-left-radius: 16px;
        border-bottom-right-radius: 16px;
      }

      /* 登入彈窗樣式 */
      .modal-backdrop {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.35);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1200;
        padding: 20px;
      }

      .modal-card {
        width: 100%;
        max-width: 420px;
        background: #fffefd;
        border-radius: 24px;
        padding: 28px;
        box-shadow: 0 24px 50px rgba(0, 0, 0, 0.18);
        position: relative;
      }

      .modal-card h3 {
        margin-top: 0;
        margin-bottom: 4px;
        font-size: 22px;
      }

      .modal-card p.lead {
        margin-top: 0;
        margin-bottom: 20px;
        color: #666;
        font-size: 14px;
      }

      .modal-close {
        position: absolute;
        top: 16px;
        right: 16px;
        width: 34px;
        height: 34px;
        border-radius: 999px;
        border: none;
        background: #f5f5f5;
        cursor: pointer;
        font-size: 18px;
        line-height: 0;
        transition: background 0.2s ease;
      }

      .modal-close:hover {
        background: #ececec;
      }

      .modal-form-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-bottom: 16px;
      }

      .modal-form-group label {
        font-weight: bold;
        color: #2f362f;
      }

      .modal-form-group input {
        padding: 12px;
        border-radius: 12px;
        border: 1px solid #c2c2c2;
        font-size: 14px;
        transition: border-color 0.2s ease;
      }

      .modal-form-group input:focus {
        outline: none;
        border-color: #8bd2c5;
      }

      .modal-status {
        margin: 0 0 16px 0;
        padding: 12px;
        border-radius: 12px;
        background: #fff7e0;
        border: 1px dashed #e7b86d;
        color: #8a641f;
        font-size: 14px;
      }

      .modal-actions {
        display: flex;
        justify-content: flex-end;
        gap: 12px;
        margin-top: 12px;
      }

      /* 預約介面樣式 */
      .appointment-form {
        margin-top: 24px;
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .form-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .form-group label {
        font-weight: bold;
        color: #2f362f;
      }

      .form-group input,
      .form-group select,
      .form-group textarea {
        padding: 12px;
        border-radius: 12px;
        border: 1px solid #c2c2c2;
        font-family: inherit;
        font-size: 14px;
        transition: border-color 0.2s ease;
      }

      .form-group input:focus,
      .form-group select:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: #8bd2c5;
      }

      .form-group textarea {
        resize: vertical;
        min-height: 100px;
      }

      .form-actions {
        display: flex;
        gap: 12px;
        justify-content: flex-end;
        margin-top: 8px;
      }

      .btn-primary {
        padding: 12px 24px;
        border-radius: 12px;
        border: none;
        background: linear-gradient(135deg, #71d2c0, #48b7ab);
        color: #fff;
        font-weight: bold;
        cursor: pointer;
        transition: transform 0.2s ease, opacity 0.2s ease;
      }

      .btn-primary:hover {
        opacity: 0.9;
        transform: translateY(-1px);
      }

      .btn-secondary {
        padding: 12px 24px;
        border-radius: 12px;
        border: 1px solid #c2c2c2;
        background: #fff;
        color: #2f362f;
        font-weight: bold;
        cursor: pointer;
        transition: background-color 0.2s ease;
      }

      .btn-secondary:hover {
        background-color: #f5f5f5;
      }

      /* 填寫症狀介面樣式 */
      .symptom-form {
        margin-top: 24px;
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .symptom-category {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .symptom-category h3 {
        margin: 0;
        font-size: 18px;
        color: #2f362f;
        border-bottom: 2px solid #8bd2c5;
        padding-bottom: 8px;
      }

      .checkbox-group {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
      }

      .checkbox-item {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 10px 16px;
        border-radius: 12px;
        border: 2px solid #d7f2ec;
        background: #f9f9f9;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .checkbox-item:hover {
        border-color: #8bd2c5;
        background: #f0f9f7;
      }

      .checkbox-item input[type="checkbox"] {
        width: 18px;
        height: 18px;
        cursor: pointer;
      }

      .checkbox-item.checked {
        border-color: #48b7ab;
        background: #e8f5f3;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.development.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
      const { useState, useEffect, useRef } = React;

      const featureConfigs = [
        {
          id: "service",
          title: "服務介紹",
          description:
            "藉由AI輔助問診降低醫療人力的負擔，提升醫療效率。",
        },
        {
          id: "schedule",
          title: "預約",
          description:
            "提供預約服務，讓使用者可以快速預約服務。",
        },
        {
          id: "symptom",
          title: "填寫症狀",
          description:
            "填寫您的症狀資訊，協助醫師更準確地進行診斷。",
        },
        {
          id: "support",
          title: "AI問診",
          description:
            "提供AI問診服務，讓使用者可以快速問診。",
        },
      ];

      function App() {
        const [activeFeature, setActiveFeature] = useState(featureConfigs[0]);
        const [draftMessage, setDraftMessage] = useState("");
        const [lastMessage, setLastMessage] = useState("");
         const [conversation, setConversation] = useState([]);
         const [aiDraft, setAiDraft] = useState("");
         const [menuOpen, setMenuOpen] = useState(false);
         const menuRef = useRef(null);
         //AI判斷疾病
         const [predictedDisease, setPredictedDisease] = useState("");
         // 預約表單狀態
         const [appointmentForm, setAppointmentForm] = useState({
           date: "",
           time: "",
           doctor: "",
           department: "",
           reason: "",
         });
         // 註冊彈窗狀態
         const [registerModalOpen, setRegisterModalOpen] = useState(false);
         const [registerForm, setRegisterForm] = useState({
           name: "",
           account: "",
           password: "",
           confirmPassword: "",
         });
         const [registerStatus, setRegisterStatus] = useState("");
         // 登入彈窗狀態
         const [loginModalOpen, setLoginModalOpen] = useState(false);
         const [loginForm, setLoginForm] = useState({
           account: "",
           password: "",
         });
         const [loginStatus, setLoginStatus] = useState("");
         // 症狀表單狀態
         const [symptomForm, setSymptomForm] = useState({
           description: "",
           duration: "",
           severity: "",
           symptoms: [],
           additionalNotes: "",
         });
         // 表單完成狀態（用於控制 AI 問診功能）
         const [appointmentCompleted, setAppointmentCompleted] = useState(false);
         const [symptomCompleted, setSymptomCompleted] = useState(false);

        // 在左側浮動視窗內更新選擇狀態與輸入訊息
        const selectFeature = (feature) => {
          setActiveFeature(feature);
        };

        // 處理聊天輸入的提交並顯示於右側區塊
        const handleSend = () => {
          if (!draftMessage.trim()) {
            return;
          }
          setLastMessage(draftMessage.trim());
          setDraftMessage("");
        };

         // 處理 AI 問診右側對話框的訊息提交，預設回覆可替換為未來串接的 LLM 結果
      const handleAiSend = async () => {
        if (!aiDraft.trim()) {
          return;
        }

        const input = aiDraft.trim();
        
        //建立當前使用者物件
        const userMessage = { role: "user", content: input };

        //使用者的話顯示在畫面上
        setConversation((prev) => [...prev, userMessage]);
        setAiDraft("");

        try {
          const GOOGLE_API_KEY = "AIzaSyCkGFAgJSYtELBMe7m5VlXVMBlI9ZOG620"; 
          const API_ENDPOINT = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${GOOGLE_API_KEY}`;

          //System Prompt
          const systemPrompt = `
你現在是一個醫療問診專案的 AI 助手。
請根據使用者的症狀描述與對話歷史，執行以下任務：

1. 【判斷疾病】：推測可能的疾病名稱（若資訊不足可寫「待觀察」）。
2. 【給予建議】：提供簡短的護理建議或就醫指引，如果你還未成功判斷出疾病，請不要給予建議，問使用者其他問題以達到判斷病因的目的。

⚠️ 重要回覆格式規定：
請務必使用 "###SEGMENT###" 符號將疾病名稱與建議分開。
格式如下：
[疾病名稱]###SEGMENT###[給使用者的親切建議]

範例：
感冒###SEGMENT###建議多喝溫開水，並多休息。

使用者目前的輸入：
`;

          //歷史對話紀錄成prompt
          const historyContents = conversation.map((msg) => ({
            role: msg.role === "user" ? "user" : "model", // Gemini 稱 AI 為 'model'
            parts: [{ text: msg.content }],
          }));

          //組合最終的 requestBody
          const requestBody = {
            contents: [
              ...historyContents, 
              {
                role: "user",
                parts: [
                  {
                    text: systemPrompt + input 
                  }
                ]
              }
            ]
          };

          const response = await fetch(API_ENDPOINT, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(requestBody) 
          });

          if (!response.ok) {
            const errorData = await response.json();
            throw new Error(`API 請求失敗: ${response.statusText} (${response.status}) - ${errorData.error.message}`);
          }

          const data = await response.json();
          
          if (!data.candidates || data.candidates.length === 0) {
              throw new Error("API 回覆中沒有找到 'candidates'");
          }
          
          // 取得完整回覆文字
          const fullText = data.candidates[0]?.content?.parts[0]?.text || "";

          //將疾病與建議分開
          const parts = fullText.split("###SEGMENT###");
          
          let diseasePart = "判斷中...";
          let advicePart = fullText; 

          if (parts.length === 2) {
            diseasePart = parts[0].trim();
            advicePart = parts[1].trim();
          }

          console.log("AI 診斷疾病:", diseasePart);
          setPredictedDisease(diseasePart);

          const botMessage = {
            role: "assistant",
            content: advicePart,
          };
          
          setConversation((prev) => [...prev, botMessage]);

        } catch (error) {
          console.error("API 呼叫失敗:", error);
          const errorMessage = {
            role: "assistant",
            content: `抱歉，發生錯誤：${error.message}`
          };
          setConversation((prev) => [...prev, errorMessage]);
        }
      };

         // 處理漢堡選單開關
         const toggleMenu = () => {
           setMenuOpen(!menuOpen);
         };

         // 處理登入/註冊選項點擊（先顯示註冊視窗）
         const handleLogin = () => {
           setMenuOpen(false);
           setRegisterStatus("");
           setRegisterModalOpen(true);
         };

         // 關閉註冊彈窗
         const closeRegisterModal = () => {
           setRegisterModalOpen(false);
         };

         // 關閉登入彈窗
         const closeLoginModal = () => {
           setLoginModalOpen(false);
         };

         // 從註冊視窗切換到登入視窗
         const switchToLogin = () => {
           setRegisterModalOpen(false);
           setLoginStatus("");
           setLoginModalOpen(true);
         };

         // 從登入視窗切換到註冊視窗
         const switchToRegister = () => {
           setLoginModalOpen(false);
           setRegisterStatus("");
           setRegisterModalOpen(true);
         };

         // 更新註冊欄位內容
         const handleRegisterInputChange = (field, value) => {
           setRegisterForm((prev) => ({ ...prev, [field]: value }));
         };

         // 更新登入欄位內容
         const handleLoginInputChange = (field, value) => {
           setLoginForm((prev) => ({ ...prev, [field]: value }));
         };

         // 暫存註冊資訊，等待未來串接後端
         const handleRegisterSubmit = (event) => {
           event.preventDefault();
           if (!registerForm.name.trim() || !registerForm.account.trim() || !registerForm.password.trim() || !registerForm.confirmPassword.trim()) {
             setRegisterStatus("請輸入完整註冊資訊。");
             return;
           }

           if (registerForm.password !== registerForm.confirmPassword) {
             setRegisterStatus("密碼與確認密碼不一致，請重新輸入。");
             return;
           }

           setRegisterStatus("註冊資訊已暫存，後續串接後端時會正式送出。");
         };

         // 暫存登入資訊，等待未來串接後端
         const handleLoginSubmit = (event) => {
           event.preventDefault();
           if (!loginForm.account.trim() || !loginForm.password.trim()) {
             setLoginStatus("請輸入完整帳號與密碼。");
             return;
           }

           setLoginStatus("登入資訊已暫存，後續串接後端時會正式送出。");
         };

         // 點擊外部關閉選單
         useEffect(() => {
           const handleClickOutside = (event) => {
             if (menuRef.current && !menuRef.current.contains(event.target)) {
               setMenuOpen(false);
             }
           };

           if (menuOpen) {
             document.addEventListener("mousedown", handleClickOutside);
           }

           return () => {
             document.removeEventListener("mousedown", handleClickOutside);
           };
         }, [menuOpen]);

         // 處理預約表單提交
         const handleAppointmentSubmit = (e) => {
           e.preventDefault();
           alert("預約成功！預約資訊已送出。");
           setAppointmentCompleted(true); // 標記預約表單已完成
           setAppointmentForm({
             date: "",
             time: "",
             doctor: "",
             department: "",
             reason: "",
           });
         };

         // 處理症狀表單提交
         const handleSymptomSubmit = (e) => {
           e.preventDefault();
           alert("症狀資訊已提交！");
           setSymptomCompleted(true); // 標記症狀表單已完成
           setSymptomForm({
             description: "",
             duration: "",
             severity: "",
             symptoms: [],
             additionalNotes: "",
           });
         };

         // 處理症狀選項切換
         const toggleSymptom = (symptom) => {
           setSymptomForm((prev) => {
             const symptoms = prev.symptoms.includes(symptom)
               ? prev.symptoms.filter((s) => s !== symptom)
               : [...prev.symptoms, symptom];
             return { ...prev, symptoms };
           });
         };

         // 常見症狀選項
         const commonSymptoms = [
           "發燒",
           "咳嗽",
           "頭痛",
           "喉嚨痛",
           "流鼻水",
           "肌肉痠痛",
           "疲勞",
           "噁心",
           "腹瀉",
           "呼吸困難",
           "胸痛",
           "頭暈",
         ];

        return (
          <div className="app">
            <aside className="sidebar">
              <h1>功能表</h1>
              <div className="feature-list">
                {featureConfigs.map((feature) => (
                  <div
                    key={feature.id}
                    className={`feature-card ${
                      activeFeature.id === feature.id ? "active" : ""
                    }`}
                    onClick={() => selectFeature(feature)}
                  >
                    {feature.title}
                  </div>
                ))}
              </div>

              <div className="chat-box">
                <label htmlFor="chat-input">快速訊息</label>
                <textarea
                  id="chat-input"
                  placeholder="輸入想詢問的內容..."
                  value={draftMessage}
                  onChange={(event) => setDraftMessage(event.target.value)}
                />
                <button type="button" onClick={handleSend}>
                  送出訊息
                </button>
              </div>
            </aside>

            {/* 漢堡選單 */}
            <div className="hamburger-menu" ref={menuRef}>
              <button
                className={`hamburger-button ${menuOpen ? "active" : ""}`}
                onClick={toggleMenu}
                aria-label="選單"
              >
                <span></span>
                <span></span>
                <span></span>
              </button>
              <div className={`menu-dropdown ${menuOpen ? "active" : ""}`}>
                <div className="menu-item" onClick={handleLogin}>
                  登入/註冊
                </div>
              </div>
            </div>

            {/* 註冊彈窗 */}
            {registerModalOpen && (
              <div className="modal-backdrop" role="dialog" aria-modal="true">
                <div className="modal-card">
                  <button
                    className="modal-close"
                    aria-label="關閉註冊視窗"
                    onClick={closeRegisterModal}
                  >
                    ×
                  </button>
                  <h3>註冊帳號</h3>
                  <p className="lead">資料不會被用來進行非醫療看診以外之行為</p>
                  <form onSubmit={handleRegisterSubmit}>
                    <div className="modal-form-group">
                      <label htmlFor="register-name">姓名</label>
                      <input
                        id="register-name"
                        type="text"
                        placeholder="請輸入姓名"
                        value={registerForm.name}
                        onChange={(event) =>
                          handleRegisterInputChange("name", event.target.value)
                        }
                        required
                      />
                    </div>
                    <div className="modal-form-group">
                      <label htmlFor="register-account">帳號（Email）</label>
                      <input
                        id="register-account"
                        type="email"
                        placeholder="example@mail.com"
                        value={registerForm.account}
                        onChange={(event) =>
                          handleRegisterInputChange("account", event.target.value)
                        }
                        required
                      />
                    </div>
                    <div className="modal-form-group">
                      <label htmlFor="register-password">密碼</label>
                      <input
                        id="register-password"
                        type="password"
                        placeholder="請輸入密碼"
                        value={registerForm.password}
                        onChange={(event) =>
                          handleRegisterInputChange("password", event.target.value)
                        }
                        required
                      />
                    </div>
                    <div className="modal-form-group">
                      <label htmlFor="register-confirm-password">確認密碼</label>
                      <input
                        id="register-confirm-password"
                        type="password"
                        placeholder="請再次輸入密碼"
                        value={registerForm.confirmPassword}
                        onChange={(event) =>
                          handleRegisterInputChange("confirmPassword", event.target.value)
                        }
                        required
                      />
                    </div>
                    {registerStatus && <p className="modal-status">{registerStatus}</p>}
                    <div className="modal-actions">
                      <button
                        type="button"
                        className="btn-secondary"
                        onClick={() => {
                          setRegisterForm({ name: "", account: "", password: "", confirmPassword: "" });
                          setRegisterStatus("");
                        }}
                      >
                        清除
                      </button>
                      <button type="submit" className="btn-primary">
                        暫存註冊資訊
                      </button>
                    </div>
                    <div style={{ marginTop: "16px", textAlign: "center" }}>
                      <button
                        type="button"
                        onClick={switchToLogin}
                        style={{
                          background: "none",
                          border: "none",
                          color: "#8bd2c5",
                          cursor: "pointer",
                          textDecoration: "underline",
                          fontSize: "14px",
                        }}
                      >
                        已有帳號？前往登入
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            )}

            {/* 登入彈窗 */}
            {loginModalOpen && (
              <div className="modal-backdrop" role="dialog" aria-modal="true">
                <div className="modal-card">
                  <button
                    className="modal-close"
                    aria-label="關閉登入視窗"
                    onClick={closeLoginModal}
                  >
                    ×
                  </button>
                  <h3>登入帳號</h3>
                  <p className="lead">資料不會被用來進行非醫療看診以外之行為</p>
                  <form onSubmit={handleLoginSubmit}>
                    <div className="modal-form-group">
                      <label htmlFor="login-account">帳號（Email）</label>
                      <input
                        id="login-account"
                        type="email"
                        placeholder="example@mail.com"
                        value={loginForm.account}
                        onChange={(event) =>
                          handleLoginInputChange("account", event.target.value)
                        }
                        required
                      />
                    </div>
                    <div className="modal-form-group">
                      <label htmlFor="login-password">密碼</label>
                      <input
                        id="login-password"
                        type="password"
                        placeholder="請輸入密碼"
                        value={loginForm.password}
                        onChange={(event) =>
                          handleLoginInputChange("password", event.target.value)
                        }
                        required
                      />
                    </div>
                    {loginStatus && <p className="modal-status">{loginStatus}</p>}
                    <div className="modal-actions">
                      <button
                        type="button"
                        className="btn-secondary"
                        onClick={() => {
                          setLoginForm({ account: "", password: "" });
                          setLoginStatus("");
                        }}
                      >
                        清除
                      </button>
                      <button type="submit" className="btn-primary">
                        暫存登入資訊
                      </button>
                    </div>
                    <div style={{ marginTop: "16px", textAlign: "center" }}>
                      <button
                        type="button"
                        onClick={switchToRegister}
                        style={{
                          background: "none",
                          border: "none",
                          color: "#8bd2c5",
                          cursor: "pointer",
                          textDecoration: "underline",
                          fontSize: "14px",
                        }}
                      >
                        還沒有帳號？前往註冊
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            )}

            <main className="content">
              <div className="content-card">
                <h2>{activeFeature.title}</h2>
                <p>{activeFeature.description}</p>

                {/* 服務介紹 */}
                {activeFeature.id === "service" && lastMessage && (
                  <div className="message-preview">
                    <strong>最新留言：</strong>
                    <p>{lastMessage}</p>
                  </div>
                )}

                {/* 預約介面 */}
                {activeFeature.id === "schedule" && (
                  <form className="appointment-form" onSubmit={handleAppointmentSubmit}>
                    <div className="form-group">
                      <label htmlFor="appointment-date">選擇日期</label>
                      <input
                        type="date"
                        id="appointment-date"
                        value={appointmentForm.date}
                        onChange={(e) =>
                          setAppointmentForm({ ...appointmentForm, date: e.target.value })
                        }
                        required
                      />
                    </div>
                    <div className="form-group">
                      <label htmlFor="appointment-time">選擇時間</label>
                      <select
                        id="appointment-time"
                        value={appointmentForm.time}
                        onChange={(e) =>
                          setAppointmentForm({ ...appointmentForm, time: e.target.value })
                        }
                        required
                      >
                        <option value="">請選擇時間</option>
                        <option value="09:00">09:00</option>
                        <option value="10:00">10:00</option>
                        <option value="11:00">11:00</option>
                        <option value="14:00">14:00</option>
                        <option value="15:00">15:00</option>
                        <option value="16:00">16:00</option>
                        <option value="17:00">17:00</option>
                      </select>
                    </div>
                    <div className="form-group">
                      <label htmlFor="appointment-department">選擇科別</label>
                      <select
                        id="appointment-department"
                        value={appointmentForm.department}
                        onChange={(e) =>
                          setAppointmentForm({ ...appointmentForm, department: e.target.value })
                        }
                        required
                      >
                        <option value="">請選擇科別</option>
                        <option value="內科">內科</option>
                        <option value="外科">外科</option>
                        <option value="小兒科">小兒科</option>
                        <option value="婦產科">婦產科</option>
                        <option value="皮膚科">皮膚科</option>
                        <option value="耳鼻喉科">耳鼻喉科</option>
                      </select>
                    </div>
                    <div className="form-group">
                      <label htmlFor="appointment-doctor">選擇醫師</label>
                      <select
                        id="appointment-doctor"
                        value={appointmentForm.doctor}
                        onChange={(e) =>
                          setAppointmentForm({ ...appointmentForm, doctor: e.target.value })
                        }
                        required
                      >
                        <option value="">請選擇醫師</option>
                        <option value="王醫師">王醫師</option>
                        <option value="李醫師">李醫師</option>
                        <option value="張醫師">張醫師</option>
                        <option value="陳醫師">陳醫師</option>
                      </select>
                    </div>
                    <div className="form-group">
                      <label htmlFor="appointment-reason">預約原因</label>
                      <textarea
                        id="appointment-reason"
                        placeholder="請簡述您的預約原因..."
                        value={appointmentForm.reason}
                        onChange={(e) =>
                          setAppointmentForm({ ...appointmentForm, reason: e.target.value })
                        }
                      />
                    </div>
                    <div className="form-actions">
                      <button type="button" className="btn-secondary" onClick={() => {
                        setAppointmentForm({
                          date: "",
                          time: "",
                          doctor: "",
                          department: "",
                          reason: "",
                        });
                        setAppointmentCompleted(false); // 清除時重置完成狀態
                      }}>
                        清除
                      </button>
                      <button type="submit" className="btn-primary">
                        確認預約
                      </button>
                    </div>
                  </form>
                )}

                {/* 填寫症狀介面 */}
                {activeFeature.id === "symptom" && (
                  <form className="symptom-form" onSubmit={handleSymptomSubmit}>
                    <div className="form-group">
                      <label htmlFor="symptom-description">主要症狀描述</label>
                      <textarea
                        id="symptom-description"
                        placeholder="請詳細描述您的主要症狀..."
                        value={symptomForm.description}
                        onChange={(e) =>
                          setSymptomForm({ ...symptomForm, description: e.target.value })
                        }
                        required
                      />
                    </div>
                    <div className="symptom-category">
                      <h3>常見症狀（可複選）</h3>
                      <div className="checkbox-group">
                        {commonSymptoms.map((symptom) => (
                          <div
                            key={symptom}
                            className={`checkbox-item ${
                              symptomForm.symptoms.includes(symptom) ? "checked" : ""
                            }`}
                            onClick={() => toggleSymptom(symptom)}
                          >
                            <input
                              type="checkbox"
                              checked={symptomForm.symptoms.includes(symptom)}
                              onChange={() => toggleSymptom(symptom)}
                            />
                            <label>{symptom}</label>
                          </div>
                        ))}
                      </div>
                    </div>
                    <div className="form-group">
                      <label htmlFor="symptom-duration">症狀持續時間</label>
                      <select
                        id="symptom-duration"
                        value={symptomForm.duration}
                        onChange={(e) =>
                          setSymptomForm({ ...symptomForm, duration: e.target.value })
                        }
                        required
                      >
                        <option value="">請選擇持續時間</option>
                        <option value="1天以內">1天以內</option>
                        <option value="2-3天">2-3天</option>
                        <option value="4-7天">4-7天</option>
                        <option value="1-2週">1-2週</option>
                        <option value="2週以上">2週以上</option>
                      </select>
                    </div>
                    <div className="form-group">
                      <label htmlFor="symptom-severity">嚴重程度</label>
                      <select
                        id="symptom-severity"
                        value={symptomForm.severity}
                        onChange={(e) =>
                          setSymptomForm({ ...symptomForm, severity: e.target.value })
                        }
                        required
                      >
                        <option value="">請選擇嚴重程度</option>
                        <option value="輕微">輕微</option>
                        <option value="中等">中等</option>
                        <option value="嚴重">嚴重</option>
                        <option value="非常嚴重">非常嚴重</option>
                      </select>
                    </div>
                    <div className="form-group">
                      <label htmlFor="symptom-notes">其他補充說明</label>
                      <textarea
                        id="symptom-notes"
                        placeholder="如有其他相關資訊，請在此補充..."
                        value={symptomForm.additionalNotes}
                        onChange={(e) =>
                          setSymptomForm({ ...symptomForm, additionalNotes: e.target.value })
                        }
                      />
                    </div>
                    <div className="form-actions">
                      <button type="button" className="btn-secondary" onClick={() => {
                        setSymptomForm({
                          description: "",
                          duration: "",
                          severity: "",
                          symptoms: [],
                          additionalNotes: "",
                        });
                        setSymptomCompleted(false); // 清除時重置完成狀態
                      }}>
                        清除
                      </button>
                      <button type="submit" className="btn-primary">
                        提交症狀資訊
                      </button>
                    </div>
                  </form>
                )}

                 {activeFeature.id === "support" && (
                   <div className="ai-chat">
                     {/* 檢查表單是否都已完成 */}
                     {!appointmentCompleted || !symptomCompleted ? (
                       <div className="ai-messages">
                         <div className="ai-bubble bot" style={{ 
                           background: "#fff7e0", 
                           border: "2px dashed #e7b86d",
                           padding: "24px",
                           textAlign: "left"
                         }}>
                           <strong style={{ display: "block", marginBottom: "12px", fontSize: "18px", color: "#8a641f" }}>
                             請先完成必要表單
                           </strong>
                           <div style={{ color: "#666", lineHeight: "1.8" }}>
                             {!appointmentCompleted && (
                               <p style={{ margin: "8px 0" }}>
                                 ❌ 尚未完成「預約」表單
                               </p>
                             )}
                             {!symptomCompleted && (
                               <p style={{ margin: "8px 0" }}>
                                 ❌ 尚未完成「填寫症狀」表單
                               </p>
                             )}
                             <p style={{ marginTop: "16px", fontSize: "14px" }}>
                               請先前往左側功能表依序完成預約以及填寫症狀表單，完成後即可使用 AI 問診功能。
                             </p>
                           </div>
                         </div>
                       </div>
                     ) : (
                       <>
                         <div className="ai-messages">
                           {conversation.length === 0 ? (
                             <div className="ai-bubble bot">
                               歡迎使用 AI 問診示範介面，輸入訊息後可預覽未來模型的回覆流程。
                             </div>
                           ) : (
                             conversation.map((message, index) => (
                               <div
                                 key={`${message.role}-${index}`}
                                 className={`ai-bubble ${
                                   message.role === "user" ? "user" : "bot"
                                 }`}
                               >
                                 {message.content}
                               </div>
                             ))
                           )}
                         </div>
                         <div className="ai-input">
                           <textarea
                             placeholder="描述症狀或提出問題..."
                             value={aiDraft}
                             onChange={(event) => setAiDraft(event.target.value)}
                           />
                           <button type="button" onClick={handleAiSend}>
                             送出
                           </button>
                         </div>
                       </>
                     )}
                   </div>
                 )}
              </div>
            </main>
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>



